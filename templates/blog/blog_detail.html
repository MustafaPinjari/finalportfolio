{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ post.title }}</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/blog.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap">
    <!-- Add CSRF token meta tag for AJAX requests -->
    <meta name="csrf-token" content="{{ csrf_token }}">
</head>
<body class="w-screen overflow-x-hidden dark:bg-darkTheme dark:text-white">
    <!-- Navbar (Same as blog_list.html) -->
    <nav class="fixed top-0 z-50 w-full flex items-center justify-between px-[8%] py-4 bg-darkTheme shadow-sm">
        <img src="{% static 'img/Mustafa_dark.png' %}" alt="Logo" class="w-28">
        <ul class="hidden md:flex gap-6">
            <li><a href="{% url 'home' %}" class="hover:text-lightHover" style="color: #ff7f50;">Home</a></li>
            <li><a href="/about" class="hover:text-lightHover" style="color: #ff7f50;">About</a></li>
            <li><a href="/blogs" class="hover:text-lightHover" style="color: #ff7f50;">Blogs</a></li>
            <li><a href="/contact" class="hover:text-lightHover" style="color: #ff7f50;">Contact</a></li>
        </ul>
        <button id="menu-button" class="md:hidden text-3xl text-coral focus:outline-none">&#9776;</button>
    </nav>

    <!-- Main Content -->
    <main class="mt-20 px-[8%] max-w-4xl mx-auto">
        <!-- Blog Header -->
        <div class="mb-12 text-center">
            <div class="flex flex-wrap gap-2 justify-center mb-6">
                {% for tag in post.tags.all %}
                <span class="inline-block bg-coral text-white text-sm px-3 py-1 rounded-full">
                    #{{ tag.name }}
                </span>
                {% endfor %}
            </div>
            <h1 class="text-4xl md:text-5xl font-bold text-coral mb-6">{{ post.title }}</h1>
            <!-- Add this near the blog header -->
            <div class="flex items-center justify-center gap-4 text-gray-400">
                <span class="flex items-center gap-2">
                    <i class="far fa-calendar"></i>
                    {{ post.created_at|date:"F j, Y" }}
                </span>
                <span>•</span>
                <span class="flex items-center gap-2">
                    <i class="far fa-folder"></i>
                    {{ post.category.name }}
                </span>
                <span>•</span>
                <span class="flex items-center gap-2">
                    <i class="far fa-eye"></i>
                    {{ post.views_count }} views
                </span>
            </div>
            
            <!-- Add favorite button -->
            {% if user.is_authenticated %}
            <div class="mt-4">
                <button class="favorite-btn group relative inline-flex items-center justify-center px-6 py-3 gap-2 rounded-full bg-darkHover backdrop-blur-md border border-white/10 hover:border-coral/30 text-white transition-all hover:shadow-lg hover:shadow-coral/20 overflow-hidden"
                        data-post-id="{{ post.id }}" 
                        onclick="toggleFavorite('{{ post.id }}')">
                    <span class="absolute -inset-px bg-gradient-to-r from-coral/20 to-purple-500/20 opacity-0 group-hover:opacity-100 transition-opacity rounded-full"></span>
                    <i class="{% if user.profile in post.favorited_by.all or post in user.profile.favorite_posts.all %}fas{% else %}far{% endif %} fa-bookmark relative z-10"></i>
                    <span class="favorite-label relative z-10">{% if user.profile in post.favorited_by.all or post in user.profile.favorite_posts.all %}Saved{% else %}Save{% endif %}</span>
                </button>
            </div>
            {% endif %}
        </div>

        <!-- Featured Image -->
        {% if post.image %}
        <div class="mb-12">
            <img src="{{ post.image.url }}" alt="{{ post.title }}" 
                 class="w-full h-[400px] md:h-[500px] object-cover rounded-xl shadow-xl">
        </div>
        {% endif %}

        <!-- Blog Content -->
        <article class="prose prose-lg prose-invert max-w-none mb-12">
            <div class="bg-darkHover/30 backdrop-blur-sm rounded-xl p-8 shadow-lg border border-white/10">
                <div class="prose-headings:text-coral prose-p:text-gray-300 prose-strong:text-coral prose-a:text-coral hover:prose-a:text-coral/70">
                    {{ post.content|safe }}
                </div>
            </div>
        </article>

        <!-- Share Buttons -->
        <div class="flex flex-wrap justify-center gap-4 mb-12">
            <a href="https://api.whatsapp.com/send?text={{ post.title }}%20-%20{{ request.build_absolute_uri }}"
               target="_blank" 
               class="px-6 py-3 bg-green-500 text-white rounded-full hover:bg-green-600 transition-colors flex items-center gap-2 shadow-lg">
                <i class="fab fa-whatsapp text-xl"></i>
                Share on WhatsApp
            </a>
            <a href="https://www.instagram.com/share?url={{ request.build_absolute_uri }}"
               target="_blank" 
               class="px-6 py-3 bg-gradient-to-r from-purple-500 via-pink-500 to-orange-500 text-white rounded-full hover:opacity-90 transition-opacity flex items-center gap-2 shadow-lg">
                <i class="fab fa-instagram text-xl"></i>
                Share on Instagram
            </a>
        </div>

        <!-- Comments Section -->
        <div class="mb-12 bg-darkHover/20 backdrop-blur-xl rounded-xl p-8 shadow-lg border border-white/10 relative overflow-hidden">
            <!-- Glassmorphism background effects -->
            <div class="absolute inset-0 bg-gradient-to-br from-coral/5 to-purple-500/5 pointer-events-none"></div>
            <div class="absolute -inset-[100px] bg-gradient-to-br from-coral/10 to-purple-500/10 blur-3xl pointer-events-none opacity-50"></div>
            
            <div class="relative z-10">  <!-- Content wrapper for proper layering -->
                <h2 class="text-3xl font-bold text-coral mb-8 flex items-center gap-3">
                    <i class="far fa-comments"></i>
                    Comments ({{ comments.count }})
                </h2>
                
                <!-- Comment Form -->
                <form method="post" class="mb-12 bg-black/30 backdrop-blur-md rounded-xl p-6 border border-white/10 transition-all hover:border-coral/30">
                    <div class="absolute inset-0 bg-gradient-to-br from-coral/5 to-purple-500/5 rounded-xl opacity-25"></div>
                {% csrf_token %}
                <div class="mb-4">
                    <label for="comment" class="block text-coral mb-2 font-medium">Leave a comment</label>
                    <textarea name="content" rows="4" 
                              class="w-full bg-white/90 rounded-lg p-4 text-black border border-white/10
                                     focus:outline-none focus:ring-0 
                                     focus:border-coral focus:ring-2 focus:ring-coral/50 transition-all
                                     placeholder-gray-500 backdrop-blur-sm
                                     hover:border-coral/30"
                              placeholder="Share your thoughts..."></textarea>
                </div>
                <button type="submit" 
                        class="mt-4 px-6 py-2 bg-coral/90 text-white rounded-lg hover:bg-coral transition-all
                               shadow-lg shadow-coral/20 hover:shadow-coral/40
                               backdrop-blur-sm">
                    Post Comment
                </button>
            </form>
        
            <!-- Comments List -->
            {% for comment in comments %}
            <div class="mb-8 bg-black/30 backdrop-blur-md rounded-xl p-6 border border-white/10 hover:border-coral/30 transition-all relative group">
                <!-- Comment background effects -->
                <div class="absolute inset-0 bg-gradient-to-br from-coral/5 to-purple-500/5 rounded-xl opacity-0 group-hover:opacity-25 transition-opacity"></div>
                
                <div class="relative z-10">  <!-- Content wrapper -->
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="text-lg font-semibold text-coral">{{ comment.author.username }}</h4>
                            <p class="text-sm text-gray-400">{{ comment.created_at|date:"F j, Y" }}</p>
                        </div>
                        <button onclick="likeComment('{{ comment.id }}')" 
                                data-comment-id="{{ comment.id }}" 
                                class="flex items-center gap-2 px-4 py-2 rounded-full bg-black/20 backdrop-blur-sm
                                       border border-white/10 hover:border-coral/30 transition-all
                                       text-gray-400 hover:text-coral group/like">
                            <i class="{% if request.user in comment.likes.all %}fas{% else %}far{% endif %} fa-heart"></i>
                            <span class="likes-count font-medium">{{ comment.likes.count }}</span>
                        </button>
                    </div>
                    <p class="text-gray-300">{{ comment.content }}</p>
                        <!-- Update the comment like button -->
                        <div class="mt-4 flex gap-4">
                            <button onclick="likeComment('{{ comment.id }}')" 
                                    class="like-btn text-coral/70 hover:text-coral flex items-center gap-2 transition-colors"
                                    data-comment-id="{{ comment.id }}">
                                <i class="far fa-heart {% if request.user in comment.likes.all %}fas{% endif %}"></i>
                                <span class="likes-count">{{ comment.likes.count }}</span> Likes
                            </button>
                            <button class="text-coral/70 hover:text-coral flex items-center gap-2 transition-colors">
                                <i class="far fa-reply"></i>
                                Reply
                            </button>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="text-center text-gray-400 py-12 bg-black/20 backdrop-blur-sm rounded-xl border border-white/5">
                    <i class="far fa-comment-dots text-5xl mb-4 block text-coral/50"></i>
                    <p class="text-lg">Be the first to comment on this post!</p>
                    <p class="text-sm mt-2 text-gray-500">Share your thoughts and start the conversation</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </main>

    <!-- Footer (Same as blog_list.html) -->
    <footer class="mx-auto flex w-full flex-col px-[8%] text-white">
        <div class="flex w-full flex-col items-center gap-5 border-b-[0.5px] border-gray-500 pb-20">
            <img src="{% static 'img/logo.png'%}" loading="lazy" alt="" class="w-40 dark:hidden" />
            <img src="{% static 'img/logo_dark.png'%}" loading="lazy" alt="" class="hidden w-40 dark:block" />
            <p class="flex gap-2 text-center text-sm text-white">
                <img src="{% static 'img/mail_icon.png' %}" loading="lazy" alt="" class="w-6 dark:hidden" />
                <img src="{% static 'img/mail_icon_dark.png'%}" loading="lazy" alt="" class="hidden w-6 dark:block" />
                mustafapinjari344@gmail.com
            </p>
        </div>
        <div class="flex flex-col items-center justify-between gap-5 py-10 md:flex-row">
            <p class="text-lg font-semibold text-white">
                &copy; 2024 Mustafa Pinjari. All rights reserved.
            </p>
            <div class="flex gap-8 md:gap-12 text-white">
                <a href="https://github.com/MustafaPinjari" class="font-medium">Github</a>
                <a href="https://www.whatsapp.com/send?text={{ post.title }}%20-%20{{ request.build_absolute_uri }}" class="font-medium">WhatsApp</a>
                <a href="https://www.instagram.com/its_ur_musuuu/" class="font-medium">Instagram</a>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="{% static 'js/sidebar.js' %}"></script>
    <!-- Add this before closing body tag -->
    <script src="{% static 'js/blog.js' %}"></script>
</body>
</html>
