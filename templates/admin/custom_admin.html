<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    {% load static %}
    <!-- Include Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom Styles -->
    <style>
        /* Custom scrollbar for sidebar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(31, 41, 55, 0.5);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #b820e6, #da7d20);
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-black text-gray-100">
    <div class="min-h-screen flex">
        <!-- Sidebar Navigation -->
        <aside class="fixed top-0 left-0 h-screen w-64 bg-gray-800/50 backdrop-blur-lg border-r border-gray-700/50 transform transition-transform duration-200 ease-in-out lg:translate-x-0 -translate-x-full z-50" id="sidebar">
            <div class="flex items-center justify-between p-4 border-b border-gray-700/50">
                <h1 class="text-xl font-bold bg-gradient-to-r from-[#b820e6] to-[#da7d20] bg-clip-text text-transparent">Admin Panel</h1>
                <button class="lg:hidden text-gray-400 hover:text-white" id="closeSidebar">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <nav class="mt-6 px-4 h-[calc(100vh-5rem)] overflow-y-auto custom-scrollbar">
                <div class="space-y-2">
                    <!-- Dashboard -->
                    <a href="{% url 'custom_admin' %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg {% if active_tab == 'dashboard' %}bg-gradient-to-r from-[#b820e6]/20 to-[#da7d20]/20 text-white{% else %}text-gray-400 hover:bg-gray-700/30 hover:text-white{% endif %} transition-all duration-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                        </svg>
                        <span>Dashboard</span>
                    </a>
                    
                    <!-- Analytics -->
                    <a href="{% url 'admin_analytics' %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg {% if active_tab == 'analytics' %}bg-gradient-to-r from-[#b820e6]/20 to-[#da7d20]/20 text-white{% else %}text-gray-400 hover:bg-gray-700/30 hover:text-white{% endif %} transition-all duration-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <span>Analytics</span>
                    </a>

                    <!-- Users -->
                    <a href="{% url 'admin_users' %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg {% if active_tab == 'users' %}bg-gradient-to-r from-[#b820e6]/20 to-[#da7d20]/20 text-white{% else %}text-gray-400 hover:bg-gray-700/30 hover:text-white{% endif %} transition-all duration-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <span>Users</span>
                    </a>

                    <!-- Blog Posts -->
                    <a href="{% url 'admin_posts' %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg {% if active_tab == 'posts' %}bg-gradient-to-r from-[#b820e6]/20 to-[#da7d20]/20 text-white{% else %}text-gray-400 hover:bg-gray-700/30 hover:text-white{% endif %} transition-all duration-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2.5 2.5 0 00-2.5-2.5H15"></path>
                        </svg>
                        <span>Blog Posts</span>
                    </a>

                    <!-- Comments -->
                    <a href="{% url 'admin_comments' %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg {% if active_tab == 'comments' %}bg-gradient-to-r from-[#b820e6]/20 to-[#da7d20]/20 text-white{% else %}text-gray-400 hover:bg-gray-700/30 hover:text-white{% endif %} transition-all duration-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                        </svg>
                        <span>Comments</span>
                    </a>

                    <!-- Categories -->
                    <a href="{% url 'admin_categories' %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg {% if active_tab == 'categories' %}bg-gradient-to-r from-[#b820e6]/20 to-[#da7d20]/20 text-white{% else %}text-gray-400 hover:bg-gray-700/30 hover:text-white{% endif %} transition-all duration-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                        </svg>
                        <span>Categories</span>
                    </a>

                    <!-- Projects Management -->
                    <a href="{% url 'projects:admin_projects' %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg {% if active_tab == 'projects' %}bg-gradient-to-r from-[#b820e6]/20 to-[#da7d20]/20 text-white{% else %}text-gray-400 hover:bg-gray-700/30 hover:text-white{% endif %} transition-all duration-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                        </svg>
                        <span>Projects</span>
                    </a>

                    <!-- Notifications system removed as requested -->

                    <!-- Settings -->
                    <a href="{% url 'admin_settings' %}" class="flex items-center space-x-3 px-4 py-3 rounded-lg {% if active_tab == 'settings' %}bg-gradient-to-r from-[#b820e6]/20 to-[#da7d20]/20 text-white{% else %}text-gray-400 hover:bg-gray-700/30 hover:text-white{% endif %} transition-all duration-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <span>Settings</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 lg:ml-64 min-h-screen">
            <!-- Top Bar -->
            <header class="sticky top-0 z-40 bg-gray-800/50 backdrop-blur-lg border-b border-gray-700/50">
                <div class="flex items-center justify-between px-6 py-4">
                    <button class="lg:hidden text-gray-400 hover:text-white" id="openSidebar">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <div class="flex items-center space-x-4 ml-auto">
                        <div class="relative">
                            <input type="text" placeholder="Search..." class="w-64 px-4 py-2 rounded-lg bg-gray-700/30 border border-gray-600/50 focus:outline-none focus:border-[#b820e6]/50 text-gray-200 placeholder-gray-400">
                        </div>
                        <button class="text-gray-400 hover:text-white relative group">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                            </svg>
                            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">3</span>
                        </button>
                        <div class="relative group">
                            <button class="flex items-center space-x-2 focus:outline-none">
                                <img src="{% if request.user.profile.profile_picture %}{{ request.user.profile.profile_picture.url }}{% else %}{% static 'img/Mustafa-light.png' %}{% endif %}" class="w-8 h-8 rounded-full object-cover">
                                <span class="text-sm font-medium">{{ request.user.username }}</span>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="p-6 space-y-6">
                <!-- Breadcrumbs -->
                <div class="flex items-center space-x-2 text-sm text-gray-400">
                    <a href="{% url 'custom_admin' %}" class="hover:text-white">Dashboard</a>
                    <span>/</span>
                    <span class="text-white">{{ active_tab|title }}</span>
                </div>

                <!-- Content Area -->
                {% block admin_content %}
                <!-- Analytics Overview -->
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Analytics Dashboard</h2>
                    <div class="flex space-x-4">
                        <select id="timeRange" class="bg-gray-700/30 border border-gray-600 text-white rounded-md focus:border-[#b820e6] focus:ring focus:ring-[#b820e6]/20">
                            <option value="7">Last 7 days</option>
                            <option value="30" selected>Last 30 days</option>
                            <option value="90">Last 90 days</option>
                        </select>
                        <button id="refreshData" class="px-4 py-2 bg-gradient-to-r from-[#b820e6] to-[#da7d20] text-white rounded-md hover:opacity-90 transition-opacity flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Refresh Data
                        </button>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Total Views -->
                    <div class="bg-gray-800/30 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-[#b820e6]/50 transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-400">Total Views</p>
                                <h3 class="text-2xl font-bold mt-2" id="total-views">{{ stats.views_count|default:0 }}</h3>
                            </div>
                            <div class="bg-gradient-to-br from-[#b820e6]/20 to-[#da7d20]/20 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4 flex items-center text-xs text-gray-400">
                            <span id="views-trend" class="text-green-400 flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                                </svg>
                                <span id="views-percent">0%</span>
                            </span>
                            <span class="ml-2">vs previous period</span>
                        </div>
                    </div>
                    
                    <!-- User Count -->
                    <div class="bg-gray-800/30 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-[#b820e6]/50 transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-400">Users</p>
                                <h3 class="text-2xl font-bold mt-2" id="user-count">{{ stats.user_count }}</h3>
                            </div>
                            <div class="bg-gradient-to-br from-[#b820e6]/20 to-[#da7d20]/20 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4 flex items-center text-xs text-gray-400">
                            <span id="users-trend" class="text-green-400 flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                                </svg>
                                <span id="users-percent">0%</span>
                            </span>
                            <span class="ml-2">vs previous period</span>
                        </div>
                    </div>
                    
                    <!-- Posts Count -->
                    <div class="bg-gray-800/30 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-[#b820e6]/50 transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-400">Posts</p>
                                <h3 class="text-2xl font-bold mt-2" id="post-count">{{ stats.post_count }}</h3>
                            </div>
                            <div class="bg-gradient-to-br from-[#b820e6]/20 to-[#da7d20]/20 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2.5 2.5 0 00-2.5-2.5H15"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4 flex items-center text-xs text-gray-400">
                            <span id="posts-trend" class="text-green-400 flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                                </svg>
                                <span id="posts-percent">0%</span>
                            </span>
                            <span class="ml-2">vs previous period</span>
                        </div>
                    </div>
                    
                    <!-- Comments Count -->
                    <div class="bg-gray-800/30 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-[#b820e6]/50 transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-400">Comments</p>
                                <h3 class="text-2xl font-bold mt-2" id="comment-count">{{ stats.comment_count }}</h3>
                            </div>
                            <div class="bg-gradient-to-br from-[#b820e6]/20 to-[#da7d20]/20 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4 flex items-center text-xs text-gray-400">
                            <span id="comments-trend" class="text-green-400 flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                                </svg>
                                <span id="comments-percent">0%</span>
                            </span>
                            <span class="ml-2">vs previous period</span>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Charts -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <!-- Post Views Chart -->
                    <div class="bg-gray-800/30 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">Post Views</h3>
                            <span id="views-trend" class="flex items-center text-green-400">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                                </svg>
                                <span id="views-percent">10%</span>
                            </span>
                        </div>
                        <div class="h-64">
                            <canvas id="postViewsChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- User Registrations Chart -->
                    <div class="bg-gray-800/30 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">User Registrations</h3>
                            <span id="users-trend" class="flex items-center text-green-400">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                                </svg>
                                <span id="users-percent">5%</span>
                            </span>
                        </div>
                        <div class="h-64">
                            <canvas id="userRegistrationsChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <!-- Comment Activity Chart -->
                    <div class="bg-gray-800/30 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">Comment Activity</h3>
                            <span id="comments-trend" class="flex items-center text-red-400">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                                <span id="comments-percent">2%</span>
                            </span>
                        </div>
                        <div class="h-64">
                            <canvas id="commentActivityChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Category Stats Chart -->
                    <div class="bg-gray-800/30 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">Category Popularity</h3>
                            <div class="flex space-x-2">
                                <select id="timeRange" class="bg-gray-700 text-sm rounded-lg px-3 py-2 border border-gray-600 focus:ring-2 focus:ring-[#b820e6] focus:border-transparent">
                                    <option value="7">Last 7 days</option>
                                    <option value="30" selected>Last 30 days</option>
                                    <option value="90">Last 90 days</option>
                                    <option value="365">Last year</option>
                                </select>
                                <button id="refreshData" class="flex items-center bg-gray-700 hover:bg-gray-600 text-sm rounded-lg px-3 py-2 transition-colors duration-200">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    Refresh Data
                                </button>
                            </div>
                        </div>
                        <div class="h-64">
                            <canvas id="categoryStatsChart"></canvas>
                        </div>
                    </div>
                </div>
                    
                <!-- Recent Activity -->
                <div class="mt-8">
                    <h2 class="text-xl font-bold mb-6">Recent Activity</h2>
                    <div class="bg-gray-800/30 backdrop-blur-sm rounded-xl border border-gray-700/50">
                        <div class="divide-y divide-gray-700/50">
                            {% for activity in recent_activities %}
                            <div class="p-4 hover:bg-gray-700/30 transition-colors duration-200">
                                <div class="flex items-center space-x-4">
                                    <div class="flex-shrink-0">
                                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#b820e6]/20 to-[#da7d20]/20 flex items-center justify-center">
                                            {% if activity.type == 'user' %}
                                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                                </svg>
                                            {% elif activity.type == 'post' %}
                                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                                </svg>
                                            {% elif activity.type == 'comment' %}
                                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                                                </svg>
                                            {% else %}
                                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-medium">{{ activity.title }}</p>
                                        <p class="text-sm text-gray-400">{{ activity.description }}</p>
                                    </div>
                                    <div class="text-sm text-gray-400">{{ activity.date|date:"M d, Y h:i A" }}</div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endblock %}
            </div>
        </main>
    </div>

    <!-- Include Chart.js and Moment.js for time formatting -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@1.0.1/dist/chartjs-adapter-moment.min.js"></script>
    
    <!-- JavaScript for Sidebar Toggle -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const openButton = document.getElementById('openSidebar');
            const closeButton = document.getElementById('closeSidebar');
            const mainContent = document.querySelector('main');

            function openSidebar() {
                sidebar.classList.remove('-translate-x-full');
                mainContent.classList.add('lg:ml-64');
                mainContent.classList.remove('lg:ml-0');
            }

            function closeSidebar() {
                sidebar.classList.add('-translate-x-full');
                mainContent.classList.remove('lg:ml-64');
                mainContent.classList.add('lg:ml-0');
            }

            openButton.addEventListener('click', openSidebar);
            closeButton.addEventListener('click', closeSidebar);
            
            // Initialize Analytics Dashboard if on the dashboard page
            if (document.getElementById('postViewsChart')) {
                initializeAnalyticsDashboard();
            }
        });
        
        // Analytics Dashboard Initialization
        function initializeAnalyticsDashboard() {
            // Chart.js global configuration
            Chart.defaults.color = '#9ca3af';  // Text color
            Chart.defaults.borderColor = 'rgba(75, 85, 99, 0.2)';  // Grid lines
            Chart.defaults.font.family = 'Outfit, system-ui, sans-serif';
            
            // Color palette for charts
            const chartColors = {
                primary: '#b820e6',
                secondary: '#da7d20',
                tertiary: '#4ade80',
                quaternary: '#3b82f6',
                background: 'rgba(30, 41, 59, 0.5)',
                border: 'rgba(30, 41, 59, 0.8)'
            };
            
            // Create gradient for charts
            function createGradient(ctx, startColor, endColor) {
                const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                gradient.addColorStop(0, startColor);
                gradient.addColorStop(1, endColor);
                return gradient;
            }
            
            // Initialize charts
            const postViewsCtx = document.getElementById('postViewsChart').getContext('2d');
            const userRegCtx = document.getElementById('userRegistrationsChart').getContext('2d');
            const commentCtx = document.getElementById('commentActivityChart').getContext('2d');
            const categoryCtx = document.getElementById('categoryStatsChart').getContext('2d');
            
            const postViewsGradient = createGradient(postViewsCtx, 'rgba(184, 32, 230, 0.5)', 'rgba(184, 32, 230, 0.0)');
            const userRegGradient = createGradient(userRegCtx, 'rgba(218, 125, 32, 0.5)', 'rgba(218, 125, 32, 0.0)');
            const commentGradient = createGradient(commentCtx, 'rgba(74, 222, 128, 0.5)', 'rgba(74, 222, 128, 0.0)');
            
            const charts = {
                postViews: new Chart(postViewsCtx, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Post Views',
                            borderColor: chartColors.primary,
                            backgroundColor: postViewsGradient,
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: chartColors.primary,
                            pointBorderColor: '#fff',
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { 
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(75, 85, 99, 0.1)'
                                },
                                ticks: {
                                    precision: 0
                                }
                            },
                            x: { 
                                type: 'time', 
                                time: { unit: 'day' },
                                grid: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#e5e7eb',
                                borderColor: 'rgba(107, 114, 128, 0.3)',
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    title: function(tooltipItems) {
                                        return moment(tooltipItems[0].parsed.x).format('MMM D, YYYY');
                                    }
                                }
                            }
                        }
                    }
                }),
                
                userRegistrations: new Chart(userRegCtx, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'New Users',
                            borderColor: chartColors.secondary,
                            backgroundColor: userRegGradient,
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: chartColors.secondary,
                            pointBorderColor: '#fff',
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { 
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(75, 85, 99, 0.1)'
                                },
                                ticks: {
                                    precision: 0
                                }
                            },
                            x: { 
                                type: 'time', 
                                time: { unit: 'day' },
                                grid: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#e5e7eb',
                                borderColor: 'rgba(107, 114, 128, 0.3)',
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false
                            }
                        }
                    }
                }),
                
                commentActivity: new Chart(commentCtx, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Comments',
                            borderColor: chartColors.tertiary,
                            backgroundColor: commentGradient,
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: chartColors.tertiary,
                            pointBorderColor: '#fff',
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { 
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(75, 85, 99, 0.1)'
                                },
                                ticks: {
                                    precision: 0
                                }
                            },
                            x: { 
                                type: 'time', 
                                time: { unit: 'day' },
                                grid: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#e5e7eb',
                                borderColor: 'rgba(107, 114, 128, 0.3)',
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false
                            }
                        }
                    }
                }),
                
                categoryStats: new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                chartColors.primary,
                                chartColors.secondary,
                                chartColors.tertiary,
                                chartColors.quaternary,
                                '#f97316',
                                '#06b6d4',
                                '#8b5cf6'
                            ],
                            borderColor: '#111827',
                            borderWidth: 2,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '65%',
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    padding: 15,
                                    usePointStyle: true,
                                    pointStyle: 'circle'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#e5e7eb',
                                borderColor: 'rgba(107, 114, 128, 0.3)',
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false
                            }
                        }
                    }
                })
            };
            
            // Fetch and update data
            async function updateCharts() {
                // Show loading indicators
                const refreshButton = document.getElementById('refreshData');
                if (refreshButton) {
                    refreshButton.innerHTML = `
                        <svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Loading...
                    `;
                }
                
                // Get selected time range
                const timeRange = document.getElementById('timeRange')?.value || '30';
                
                try {
                    const response = await fetch(`/admin/api/analytics/?days=${timeRange}`);
                    const data = await response.json();
                    
                    if (!data.success) {
                        throw new Error('Failed to fetch analytics data');
                    }
                    
                    // Update post views chart
                    if (charts.postViews && data.post_views) {
                        charts.postViews.data = {
                            labels: data.post_views.map(item => item.date),
                            datasets: [{
                                label: 'Post Views',
                                data: data.post_views.map(item => ({x: item.date, y: item.count})),
                                borderColor: chartColors.primary,
                                backgroundColor: postViewsGradient,
                                tension: 0.4,
                                fill: true,
                                pointBackgroundColor: chartColors.primary,
                                pointBorderColor: '#fff',
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }]
                        };
                        charts.postViews.update();
                    }
                    
                    // Update user registrations chart
                    if (charts.userRegistrations && data.user_registrations) {
                        charts.userRegistrations.data = {
                            labels: data.user_registrations.map(item => item.date),
                            datasets: [{
                                label: 'New Users',
                                data: data.user_registrations.map(item => ({x: item.date, y: item.count})),
                                borderColor: chartColors.secondary,
                                backgroundColor: userRegGradient,
                                tension: 0.4,
                                fill: true,
                                pointBackgroundColor: chartColors.secondary,
                                pointBorderColor: '#fff',
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }]
                        };
                        charts.userRegistrations.update();
                    }
                    
                    // Update comment activity chart
                    if (charts.commentActivity && data.comment_activity) {
                        charts.commentActivity.data = {
                            labels: data.comment_activity.map(item => item.date),
                            datasets: [{
                                label: 'Comments',
                                data: data.comment_activity.map(item => ({x: item.date, y: item.count})),
                                borderColor: chartColors.tertiary,
                                backgroundColor: commentGradient,
                                tension: 0.4,
                                fill: true,
                                pointBackgroundColor: chartColors.tertiary,
                                pointBorderColor: '#fff',
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }]
                        };
                        charts.commentActivity.update();
                    }
                    
                    // Update category stats chart
                    if (charts.categoryStats && data.category_stats) {
                        charts.categoryStats.data = {
                            labels: data.category_stats.map(item => item.name),
                            datasets: [{
                                data: data.category_stats.map(item => item.count),
                                backgroundColor: [
                                    chartColors.primary,
                                    chartColors.secondary,
                                    chartColors.tertiary,
                                    chartColors.quaternary,
                                    '#f97316',
                                    '#06b6d4',
                                    '#8b5cf6'
                                ],
                                borderColor: '#111827',
                                borderWidth: 2,
                                hoverOffset: 10
                            }]
                        };
                        charts.categoryStats.update();
                    }
                    
                    // Update trend percentages
                    updateTrendPercentages(data);
                    
                    // Restore refresh button
                    if (refreshButton) {
                        refreshButton.innerHTML = `
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Refresh Data
                        `;
                    }
                } catch (error) {
                    console.error('Error fetching analytics data:', error);
                    
                    // Restore refresh button on error
                    if (refreshButton) {
                        refreshButton.innerHTML = `
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Refresh Data
                        `;
                    }
                }
            }
            
            // Calculate and update trend percentages
            function updateTrendPercentages(data) {
                // Calculate trends (simplified example)
                let viewsTrend = 10; // Placeholder: 10% increase
                let usersTrend = 5;  // Placeholder: 5% increase
                let commentsTrend = -2; // Placeholder: 2% decrease
                let postsTrend = 8; // Placeholder: 8% increase
                
                // Views trend
                updateTrendIndicator('views-trend', 'views-percent', viewsTrend);
                
                // Users trend
                updateTrendIndicator('users-trend', 'users-percent', usersTrend);
                
                // Posts trend
                updateTrendIndicator('posts-trend', 'posts-percent', postsTrend);
                
                // Comments trend
                updateTrendIndicator('comments-trend', 'comments-percent', commentsTrend);
            }
            
            // Helper function to update trend indicators
            function updateTrendIndicator(trendElementId, percentElementId, trendValue) {
                const trendElement = document.getElementById(trendElementId);
                const percentElement = document.getElementById(percentElementId);
                
                if (trendElement && percentElement) {
                    percentElement.textContent = `${Math.abs(trendValue)}%`;
                    
                    if (trendValue >= 0) {
                        trendElement.classList.remove('text-red-400');
                        trendElement.classList.add('text-green-400');
                        trendElement.querySelector('svg').innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>';
                    } else {
                        trendElement.classList.remove('text-green-400');
                        trendElement.classList.add('text-red-400');
                        trendElement.querySelector('svg').innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>';
                    }
                }
            }
            
            // Set up event listeners
            const refreshButton = document.getElementById('refreshData');
            const timeRangeSelect = document.getElementById('timeRange');
            
            if (refreshButton) {
                refreshButton.addEventListener('click', updateCharts);
            }
            
            if (timeRangeSelect) {
                timeRangeSelect.addEventListener('change', updateCharts);
            }
            
            // Initial data load
            updateCharts();
            
            // Auto-refresh data every 60 seconds for real-time feel
            setInterval(updateCharts, 60000);
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            if (window.innerWidth < 1024 && // Only on mobile/tablet
                !sidebar.contains(event.target) && // Click not on sidebar
                !openButton.contains(event.target)) { // Click not on open button
                closeSidebar();
            }
        });

        // Handle window resize
        let resizeTimer;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                if (window.innerWidth >= 1024) {
                    sidebar.classList.remove('-translate-x-full');
                    mainContent.classList.add('lg:ml-64');
                    mainContent.classList.remove('lg:ml-0');
                } else {
                    sidebar.classList.add('-translate-x-full');
                    mainContent.classList.remove('lg:ml-64');
                    mainContent.classList.add('lg:ml-0');
                }
            }, 100);
        });

        // Handle Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && window.innerWidth < 1024 && !sidebar.classList.contains('-translate-x-full')) {
                closeSidebar();
            }
        });
    </script>
</body>
</html>
